<div class="bg-light break-out">
  <h2 class="container-fluid pt-3 pb-2">Charts</h2>

  <%= form_with(url: "", method: :get, local: true, id: "filter_form", class: "container-fluid") do |form| %>
    <div class="d-flex flex-row w-100">
      <div class="me-2">
        <select name="duration" id="duration_filter" class="form-select form-select-sm">
          <% GoodJob::ChartsFilter::DURATIONS.each do |(duration, interval)| %>
            <option value="<%= duration.to_param %>" <%= "selected='selected'" if params[:duration] == duration %>>Previous <%= duration %>
              (<%= interval %> breakdown)
            </option>
          <% end %>
        </select>
      </div>
    </div>
  <% end %>
</div>

<% latency_chart = GoodJob::LatencyChart.new(@filter, interval: :minute) %>

<br>

<div class="card">
  <div class="card-header">Latency</div>
  <div class="card-body">

    <div class="card">
      <div class="card-header">Total Latency</div>
      <div class="card-body">
        <%= render "good_job/shared/chart", chart_data: latency_chart.total_latency %>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Queue Latency</div>
      <div class="card-body">
        <%= render "good_job/shared/chart", chart_data: latency_chart.queue_latency %>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Perform Latency</div>
      <div class="card-body">
        <%= render "good_job/shared/chart", chart_data: latency_chart.perform_latency %>
      </div>
    </div>
  </div>
</div>

<%= javascript_tag nonce: true do %>
  /* JavaScript code */

  document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("#duration_filter, #job_queue_filter").forEach((filter) => {
  filter.addEventListener("change", () => {
  document.querySelector("#filter_form").submit();
  });
  })
  })
<% end %>


